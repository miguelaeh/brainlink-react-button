import * as BrainLink from "@brainlink/spa-sdk";
import React, { useEffect, useState } from "react";

/**
 * @param appClientId The brainlink client app id. To obtain this register the app on the brainlink dashboard
 * @param appCallbackUrl The callback URL for the brainlink client app. If not provided, the current page will be used
 */
export default function BrainLinkButton({ appClientId, appCallbackUrl }: { appClientId: string, appCallbackUrl?: string }) {
    const [brainLinkConnected, setBrainLinkConnected] = useState<boolean>(false);

    const connectBrainLink = async () => {
        // The startCodeExchange redirects to the authorize endpoint which loses the state after the redirect,
        // but we do this because it could skip the start if brainlink is already connected
        await BrainLink.startCodeExchange(appClientId, appCallbackUrl);
        setBrainLinkConnected(BrainLink.isConnected());
    }

    useEffect(() => {
        const handleConnectionChange = () => {
            setBrainLinkConnected(BrainLink.isConnected());
        };

        window.addEventListener('brainLinkConnectedChange', handleConnectionChange);

        return () => {
            window.removeEventListener('brainLinkConnectedChange', handleConnectionChange);
        };
    }, []);

    return (
        <button style={{
            background: brainLinkConnected ? "#34a853" : "#ffffff",
            display: "flex",
            paddingTop: "0.25rem",
            paddingBottom: "0.25rem",
            paddingLeft: "0.5rem",
            paddingRight: "0.5rem",
            alignItems: "center",
            borderRadius: "0.375rem",
            borderWidth: "2px",
            borderColor: brainLinkConnected ? "#ffffff" : "#000000",
            color: brainLinkConnected ? "#ffffff" : "#000000",
            gap: "0.5rem",
            fontWeight: 600,
        }}
            onClick={connectBrainLink}
            onMouseEnter={(e) => { if (!brainLinkConnected) e.currentTarget.style.backgroundColor = "#F3F4F6" }}
            onMouseLeave={(e) => { if (!brainLinkConnected) e.currentTarget.style.backgroundColor = "#ffffff" }}
        >
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 500 500">
                <path d="M0 0 C1.010625 0.42410156 2.02125 0.84820313 3.0625 1.28515625 C10.53876182 4.70859757 17.1275746 9.22005374 23 15 C23 15.66 23 16.32 23 17 C24.01707031 16.12988281 24.01707031 16.12988281 25.0546875 15.2421875 C42.91739783 0.24938631 59.77147819 -5.82008446 83 -4 C98.71940622 -1.58212579 114.1419217 7.81456512 123.5625 20.5625 C128.53700759 28.05848965 133.89184806 36.39115706 134.6875 45.5 C134.93191555 47.91138064 134.93191555 47.91138064 136 50 C138.80413599 51.9236102 141.64353627 53.18622156 144.76953125 54.51953125 C149.87930502 56.86125345 153.83225309 60.27928865 158 64 C159.14082031 64.99966797 159.14082031 64.99966797 160.3046875 66.01953125 C174.18006943 78.95868498 183.25963792 97.61600412 184.11669922 116.58251953 C184.21836145 119.57624471 184.27477354 122.56730521 184.3125 125.5625 C184.33038574 126.52027344 184.34827148 127.47804687 184.36669922 128.46484375 C184.35935999 134.58786093 183.46624936 139.78471618 181.54760742 145.60522461 C180.9525357 148.20756903 181.07890461 149.52253656 182 152 C182.99023008 153.4937369 184.03961235 154.94890771 185.125 156.375 C198.30197241 174.75768991 202.89643118 196.18544887 199.38671875 218.51953125 C196.06923615 235.74015671 186.94585677 253.23381786 172.9375 264.0625 C170.34746736 266.23595397 169.16668414 267.31700156 168.359375 270.625 C168.24148783 272.63979883 168.17100918 274.65776527 168.140625 276.67578125 C167.35215879 295.31424644 155.98427862 314.60749694 142.8125 327.1875 C128.9918772 339.24460366 112.4220216 347.13844741 94 348 C92.20755859 348.09667969 92.20755859 348.09667969 90.37890625 348.1953125 C71.6654444 348.89407841 56.8406204 342.50437224 41 333 C40.67 339.93 40.34 346.86 40 354 C42.64 354 45.28 354 48 354 C60.87927018 356.79984134 72.05969038 363.66201438 79.72265625 374.41796875 C83.05439978 379.69800457 85.37209009 384.98024683 87 391 C87.17128418 391.56976563 87.34256836 392.13953125 87.51904297 392.7265625 C88.64820016 398.06397965 88.27223774 403.69227953 88.3125 409.125 C88.34150391 410.40632813 88.37050781 411.68765625 88.40039062 413.0078125 C88.47718619 424.53896209 85.92534702 433.42081185 78 442 C74.40816327 445 74.40816327 445 72 445 C72.02356567 446.08885498 72.02356567 446.08885498 72.04760742 447.19970703 C72.11020355 450.50805788 72.14906912 453.81628381 72.1875 457.125 C72.21263672 458.26710938 72.23777344 459.40921875 72.26367188 460.5859375 C72.32267196 467.35128022 72.27178208 472.41296809 67.5 477.64453125 C62.09279135 481.85483174 57.72106323 482.82862423 51 482 C46.0289851 479.46759618 42.50569433 476.01138866 40 471 C39.91599471 469.40552536 39.89272533 467.80759455 39.90234375 466.2109375 C39.90484131 465.36321777 39.90733887 464.51549805 39.90991211 463.64208984 C39.91901611 462.5639502 39.92812012 461.48581055 39.9375 460.375 C39.958125 456.95125 39.97875 453.5275 40 450 C29.44 450 18.88 450 8 450 C8.11805662 456.31216954 8.11805662 456.31216954 8.27026367 462.62353516 C8.32674429 468.63234406 7.71632298 473.02194798 3.5 477.64453125 C-1.90720865 481.85483174 -6.27893677 482.82862423 -13 482 C-17.9710149 479.46759618 -21.49430567 476.01138866 -24 471 C-24.05867634 469.19492582 -24.06110688 467.3878724 -24.03515625 465.58203125 C-24.04095703 464.49212891 -24.04675781 463.40222656 -24.05273438 462.27929688 C-24.05919002 459.98754461 -24.03881668 457.69554324 -23.99023438 455.40429688 C-23.97612754 449.16274725 -23.97612754 449.16274725 -26.7421875 443.78100586 C-28.82153485 441.94043332 -28.82153485 441.94043332 -31.00219727 440.47753906 C-36.00420278 436.77814552 -38.31669607 430.80062073 -40 425 C-40.37833425 420.67586209 -40.37162827 416.35505359 -40.37060547 412.0168457 C-40.37493821 409.9667388 -40.41119236 407.91886182 -40.44921875 405.86914062 C-40.58705423 389.91673248 -36.0233427 378.33012281 -25.1875 366.75 C-15.5998063 357.64077086 -5.14075285 354 8 354 C8 347.07 8 340.14 8 333 C6.576875 333.886875 5.15375 334.77375 3.6875 335.6875 C-16.9351859 347.95120101 -39.82756576 350.84593326 -63 345 C-83.8899432 338.17011438 -101.13816285 323.89831774 -111.25 304.375 C-116.04411442 294.66130694 -119.12652105 284.58236851 -119 273.6875 C-119.24408364 269.05616931 -120.53235779 266.95970936 -123.94848633 263.81640625 C-125.57247252 262.42898014 -127.21290973 261.0637676 -128.859375 259.703125 C-141.6623034 249.04679537 -148.6154855 231.12128206 -151.75 215.1875 C-151.86371091 213.79381246 -151.94120026 212.39708186 -152 211 C-152.06316406 209.86304688 -152.12632812 208.72609375 -152.19140625 207.5546875 C-152.7763518 188.27035354 -147.24910309 168.41696982 -134.34765625 153.6640625 C-132.78115829 151.92899669 -132.78115829 151.92899669 -132 149 C-132.50442936 146.50416829 -132.50442936 146.50416829 -133.375 143.8125 C-138.70652053 125.14000571 -136.31308004 106.40996477 -128 89 C-127.56945312 88.08605469 -127.13890625 87.17210938 -126.6953125 86.23046875 C-119.33543659 71.69783242 -107.82896493 59.87873158 -92.9375 53.1875 C-89.59644071 51.47351727 -88.28065834 50.58470487 -86.640625 47.16796875 C-85.9960188 44.94090717 -85.407406 42.69699699 -84.87109375 40.44140625 C-81.04605154 25.32991663 -70.08778581 12.88535875 -57.0625 4.8125 C-39.69590047 -5.16066206 -18.82617955 -8.2108745 0 0 Z " fill={brainLinkConnected ? "#ffffff" : "#000000"} transform="translate(228,14)" />
                <path d="M0 0 C6.76815866 5.19519871 11.17892573 11.65265678 13 20 C13.09884967 22.98031922 13.14346902 25.93726146 13.14044189 28.91763306 C13.14341302 29.82871083 13.14638414 30.7397886 13.1494453 31.67847478 C13.15813253 34.73829583 13.15964058 37.79807775 13.16113281 40.85791016 C13.16576103 43.04914432 13.1707857 45.24037769 13.17617798 47.43161011 C13.18930512 53.39053202 13.19574776 59.34944267 13.20018864 65.30837679 C13.20311935 69.03188383 13.2072242 72.75538779 13.21169281 76.47889328 C13.22536966 88.13045076 13.23505081 99.78200178 13.2388947 111.43356669 C13.23933816 112.77423326 13.23978473 114.11489984 13.24023438 115.45556641 C13.24056652 116.4530853 13.24056652 116.4530853 13.24090537 117.4707561 C13.24485011 128.23701055 13.2622943 139.00319719 13.2855939 149.76942547 C13.30934169 160.83242516 13.32151368 171.89538917 13.32293582 182.95841444 C13.32398329 189.16600732 13.32987883 195.37350458 13.34775543 201.58107376 C13.36425271 207.42349107 13.36638346 213.26574105 13.35761642 219.10817337 C13.3568469 221.24868213 13.36117761 223.38919995 13.37107468 225.52968597 C13.38382604 228.4601434 13.37789988 231.39001108 13.36749268 234.32046509 C13.37957728 235.58003838 13.37957728 235.58003838 13.39190602 236.86505759 C13.28420139 249.90309012 7.60267776 260.3003636 -1.125 269.75 C-12.16111779 280.23996179 -24.43038694 283.55981111 -39.22265625 283.30859375 C-52.88513815 282.19242408 -64.29334942 274.90351047 -73.05078125 264.63671875 C-80 255.23647295 -80 255.23647295 -80 250 C-78.84242188 250.03480469 -77.68484375 250.06960938 -76.4921875 250.10546875 C-74.9531396 250.13362207 -73.41407589 250.16092056 -71.875 250.1875 C-71.11445313 250.21263672 -70.35390625 250.23777344 -69.5703125 250.26367188 C-64.61000956 250.32781372 -61.30582531 249.7341666 -57 247 C-53.15038547 242.83825457 -51.85136776 239.67996311 -51.75 234.0625 C-51.71132812 232.78052734 -51.71132812 232.78052734 -51.671875 231.47265625 C-52.06302421 228.52506759 -53.14152227 227.2644084 -55 225 C-55 224.34 -55 223.68 -55 223 C-59.65565361 221.11257286 -63.56278111 219.92806461 -68.59741211 219.55834961 C-83.9618901 218.28658471 -95.63434516 211.67682811 -105.76953125 199.953125 C-113.68297555 189.29501773 -116.52487184 176.02554078 -115 163 C-111.51455377 146.76054661 -101.97466287 135.96501114 -88.41796875 127.0546875 C-84.92454625 124.08612492 -83.38784825 120.94525442 -82.49609375 116.47265625 C-82.38591618 111.94068536 -82.63168675 108.74123292 -85.4375 105.0625 C-88.56981585 101.86274194 -91.8414964 100.7122119 -96.14453125 99.703125 C-96.75683594 99.47109375 -97.36914062 99.2390625 -98 99 C-101.14351751 89.56944746 -98.62389806 78.66022455 -94.55859375 69.890625 C-90.80145238 63.0214199 -86.25974044 56.80398685 -80 52 C-79.01 52 -78.02 52 -77 52 C-76.731875 52.59167969 -76.46375 53.18335938 -76.1875 53.79296875 C-73.2477592 59.72080136 -70.29442139 63.57548213 -64 66 C-59.78792355 66.90029115 -56.10577229 66.32839046 -52.25 64.4375 C-48.54750569 62.0228298 -46.45018642 59.16288807 -45 55 C-44.18619193 49.57461288 -44.95124328 46.86229542 -47.5 42.0625 C-51.46906708 33.94343971 -51.28587006 24.63915082 -49.30078125 15.93359375 C-46.11051484 7.11661273 -40.29979975 1.18257625 -32 -3 C-21.32742364 -7.39459026 -9.7597625 -5.76649773 0 0 Z " fill={brainLinkConnected ? "#34a853" : "#ffffff"} transform="translate(223,47)" />
                <path d="M0 0 C8.8320809 5.1460634 14.67640458 11.40268186 17.4375 21.4375 C18.56565293 30.54527121 17.9090272 37.72825172 13.56640625 45.98046875 C11.48699689 50.50624206 11.48198691 54.74177872 13.13671875 59.41015625 C15.34064057 63.79010215 18.06640357 66.33601133 22.4375 68.4375 C27.7712898 69.12573094 31.78947357 68.56409929 36.5390625 65.9921875 C40.25544286 62.94873198 42.30502366 58.67014243 44.4375 54.4375 C53.09767722 57.37416909 57.50184958 64.96871031 61.375 72.8125 C65.57072981 81.58625846 65.57072981 81.58625846 65.53515625 86.88671875 C65.53032227 88.15805664 65.53032227 88.15805664 65.52539062 89.45507812 C65.51282227 90.77668945 65.51282227 90.77668945 65.5 92.125 C65.49548828 93.01767578 65.49097656 93.91035156 65.48632812 94.83007812 C65.47454983 97.03261987 65.45810164 99.23502599 65.4375 101.4375 C64.82189209 101.62578369 64.20628418 101.81406738 63.57202148 102.00805664 C62.76321533 102.26449951 61.95440918 102.52094238 61.12109375 102.78515625 C60.31986084 103.03531494 59.51862793 103.28547363 58.69311523 103.54321289 C54.77569183 105.09635954 52.44000149 107.77925268 50.296875 111.32421875 C49.30361234 113.76674192 49.30993759 115.20981054 49.625 117.8125 C49.70105469 118.54210937 49.77710938 119.27171875 49.85546875 120.0234375 C51.40139061 126.43538185 54.09720943 129.30890177 59.625 132.75 C70.55652708 139.93760415 77.61623859 148.9682408 81.0859375 161.84375 C83.17306562 177.24211745 80.6781139 190.79379756 71.875 203.734375 C67.34132603 209.35787444 61.68544232 212.92972667 55.4375 216.4375 C54.39335937 217.05818359 54.39335937 217.05818359 53.328125 217.69140625 C48.28768387 220.33861467 43.45614045 220.85837185 37.875 221.375 C31.59426352 221.9564867 26.01849974 222.63076984 21.4375 227.4375 C19.29411917 230.71687268 19.13965485 233.50123508 19.125 237.375 C19.09986328 238.90447266 19.09986328 238.90447266 19.07421875 240.46484375 C19.50630994 244.00055769 20.19488758 245.66506469 22.4375 248.4375 C27.95319429 252.52732124 32.1366374 252.9698488 38.875 252.6875 C39.70193359 252.66945313 40.52886719 252.65140625 41.38085938 252.6328125 C43.40024933 252.5861214 45.41903445 252.51439393 47.4375 252.4375 C43.47545624 264.68855635 36.41690513 272.8392998 25.4375 279.4375 C24.756875 279.84871094 24.07625 280.25992187 23.375 280.68359375 C12.66049562 286.58089153 -0.56658816 287.08694835 -12.1875 283.875 C-25.85266118 279.16060181 -35.11562236 270.88572385 -41.5 258.0625 C-44.62446468 251.52888138 -45.71120194 246.73138343 -45.70967102 239.52622986 C-45.71334771 238.60375586 -45.7170244 237.68128185 -45.7208125 236.73085409 C-45.73186328 233.62647203 -45.73569558 230.52212342 -45.73950195 227.41772461 C-45.74576564 225.19708143 -45.75241235 222.97643931 -45.75941467 220.75579834 C-45.77683519 214.71211251 -45.78737971 208.6684346 -45.7956202 202.62472987 C-45.80076904 198.84879783 -45.80684488 195.07286825 -45.81313133 191.29693794 C-45.83000354 180.83724647 -45.84463733 170.37755614 -45.85188007 159.91785336 C-45.8537899 157.20378048 -45.85571024 154.48970761 -45.85766602 151.77563477 C-45.85814976 151.10108482 -45.8586335 150.42653488 -45.8591319 149.73154403 C-45.86742565 138.81324139 -45.89275087 127.89504855 -45.92524669 116.97679382 C-45.95835755 105.76014801 -45.97600009 94.54355584 -45.97952431 83.32685477 C-45.98187439 77.03202301 -45.99082937 70.7373647 -46.01598549 64.44257927 C-46.03928181 58.51724313 -46.04349295 52.59219443 -46.03322411 46.66682434 C-46.03272899 44.49567267 -46.03904215 42.32450678 -46.05278015 40.15339851 C-46.07053033 37.18114211 -46.06337713 34.20991377 -46.05024719 31.23765564 C-46.06121644 30.38558515 -46.07218568 29.53351466 -46.08348733 28.65562385 C-45.99358627 20.18200797 -43.22267201 12.3124171 -37.41015625 6.0390625 C-26.89751583 -3.07337423 -12.80132086 -6.09278056 0 0 Z " fill={brainLinkConnected ? "#34a853" : "#ffffff"} transform="translate(314.5625,44.5625)" />
                <path d="M0 0 C1.33590935 -0.01210762 1.33590935 -0.01210762 2.69880676 -0.02445984 C4.58767752 -0.03830585 6.47657336 -0.04902569 8.36547852 -0.05688477 C11.24088757 -0.07404778 14.11513186 -0.1179226 16.99023438 -0.16210938 C18.82681447 -0.17224083 20.66340434 -0.18075552 22.5 -0.1875 C23.35442184 -0.20500809 24.20884369 -0.22251617 25.0891571 -0.24055481 C30.93035138 -0.21955775 34.27739126 0.8768411 39.08203125 4.23828125 C47.15056556 12.94380511 44.08203125 18.12678129 44.08203125 32.23828125 C22.96203125 32.23828125 1.84203125 32.23828125 -19.91796875 32.23828125 C-19.91796875 11.23828125 -19.91796875 11.23828125 -15.91796875 5.23828125 C-10.51147377 0.47541662 -7.05909451 0.06031517 0 0 Z " fill={brainLinkConnected ? "#34a853" : "#ffffff"} transform="translate(239.91796875,399.76171875)" />
            </svg>
            <span>{brainLinkConnected ? "BrainLink" : "BrainLink"}</span>
        </button >
    );
}
